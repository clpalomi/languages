<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Study Session</title>
<style>
  /* ===== Minimal tokens ===== */
  :root{
    --fg:#111; --muted:#6b7280; --bg:#fff; --border:#e5e7eb;
    --brand:#6d28d9; --brand-2:#7c3aed; --accent:#22c55e; --danger:#ef4444;
    --tap:48px; --r:14px; --measure:72ch;
  }
  @media (prefers-color-scheme: dark){
    :root{ --fg:#e5e7eb; --muted:#9aa3b2; --bg:#0b0e14; --border:#262b36; }
  }

  /* ===== Base ===== */
  *,*::before,*::after{ box-sizing:border-box }
  html,body{ height:100% }
  body{
    margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    color:var(--fg); background:var(--bg);
  }
  .shell{ max-width:1100px; margin:0 auto; padding: clamp(10px, 2vw, 18px); }

  /* ===== Header (minimal) ===== */
  .hdr{
    display:flex; align-items:center; justify-content:space-between; gap:12px;
    padding:8px 0; position:sticky; top:0; background:var(--bg); z-index:20;
    border-bottom:1px solid var(--border);
  }
  .brand{ font-weight:800; letter-spacing:-0.01em }
  .hamburger{
    inline-size: var(--tap); block-size: var(--tap); border:0; background:transparent; padding:0; cursor:pointer;
    display:grid; place-items:center; border-radius:10px;
  }
  .hamburger:focus-visible{ outline:2px solid var(--brand) }
  .hamburger .bars{ inline-size:24px; block-size:18px; position:relative }
  .hamburger .bars::before,
  .hamburger .bars::after,
  .hamburger .bar{
    content:""; position:absolute; left:0; right:0; height:2px; background:currentColor; border-radius:2px;
  }
  .hamburger .bar{ top:8px }
  .hamburger .bars::before{ top:0 }
  .hamburger .bars::after{ bottom:0 }

  /* ===== Lessons drawer (mobile-first full width; compact on wider screens) ===== */
  .drawer{
    display:none; border-bottom:1px solid var(--border); background:var(--bg);
    position: static; z-index:100;
  }
  .drawer.open{ display:block; }
  @media (min-width:480px){
    .hdr{ position:relative; z-index:101; }
    .drawer{
      position:absolute; top:100%; left:0;
      border:1px solid var(--border); border-top:none;
      border-radius:0 0 var(--r) var(--r);
      box-shadow:0 14px 40px rgba(0,0,0,.12);
      padding:8px 10px 10px;
      inline-size:max-content; max-inline-size:90vw; min-inline-size:220px;
    }
  }
  .lessons{ display:grid; gap:6px; padding:6px 0; }
  .lesson{
    min-height: calc(var(--tap) - 8px);
    padding: 0 10px;
    border:1px solid var(--border);
    border-radius:10px;
    background:transparent; color:var(--fg);
    text-align:left; font-weight:700; cursor:pointer;
    white-space:nowrap;
  }
  .lesson[disabled]{ opacity:.6; cursor:not-allowed }
  .badge{ font-size:12px; color:var(--muted); margin-left:8px }
  .sep{ border:none; border-top:1px solid var(--border); margin:6px 0; }

  /* Drawer actions */
  .menu-action{
    min-height: calc(var(--tap) - 12px);
    padding: 0 8px;
    border:0; background:transparent; color:var(--fg);
    text-align:left; font-weight:700; cursor:pointer;
  }

  /* ===== Reader (clean page) ===== */
  .reader{ padding: clamp(10px, 3vw, 24px) 0; }
  .page{
    max-width:min(100%, var(--measure));
    margin:0 auto;
    background:#fff0; /* ultra clean */
    color:var(--fg); font-family: Georgia, "Times New Roman", serif;
    line-height:1.7; font-size: clamp(17px, 1.9vw, 19px);
  }
  .page h3{ margin:0 0 6px; font-weight:700; letter-spacing:-.01em }
  .meta{ color:var(--muted); font-size:12px; margin:0 0 12px }
  .page p{ margin:0 0 14px; text-align:justify; hyphens:auto }

  /* ===== Floating Pomodoro (tomato) ===== */
  .tomato{
    position: fixed; right: clamp(10px, 3vw, 22px); bottom: clamp(12px, 3vw, 22px);
    inline-size: 64px; block-size: 64px; border:0; padding:0; background:transparent; cursor:pointer;
    z-index: 30;
  }
  .tomato svg{ display:block; inline-size:100%; block-size:100%; filter: drop-shadow(0 8px 16px rgba(0,0,0,.2)); }
  .tomato.vanish{ opacity:0; transition: opacity .18s ease; }
  .tomato.vanish:hover{ opacity:1; }

  /* Invisible hotspot to recover on mobile—still clickable even when invisible */
  .tomato-hotspot{
    position: fixed; right: clamp(6px, 3vw, 18px); bottom: clamp(8px, 3vw, 18px);
    inline-size: 72px; block-size: 72px; z-index: 29; background: transparent;
  }

  /* Tomato sheet (controls) */
  .sheet{
    position: fixed; right: clamp(10px, 3vw, 22px); bottom: calc(clamp(12px, 3vw, 22px) + 72px);
    background: var(--bg); border:1px solid var(--border); border-radius: var(--r); padding:12px;
    box-shadow: 0 20px 50px rgba(0,0,0,.18); z-index: 35; min-inline-size: 240px;
    opacity:0; transform: translateY(6px); pointer-events:none; transition: opacity .18s, transform .18s;
  }
  .sheet.open{ opacity:1; transform:none; pointer-events:auto }

  /* NEW: Vanish the entire pomodoro box while running; reveal on hover/focus */
  .sheet.vanish{
    opacity:0; transform: translateY(6px);
    pointer-events:auto; /* allow hover to revive it */
    transition: opacity .18s, transform .18s;
  }
  .sheet.vanish:hover,
  .sheet.vanish:focus-within{
    opacity:1; transform:none;
  }

  .row{ display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
  .time{ font-weight:800; letter-spacing:.03em; font-variant-numeric: tabular-nums; }
  input[type="number"]{
    inline-size:84px; min-height: var(--tap); padding:0 10px; border-radius:10px; border:1px solid var(--border);
    background:transparent; color:var(--fg); font-weight:700;
  }
  .btn{
    min-height: var(--tap); padding:0 12px; border-radius:10px; border:1px solid var(--border);
    background:transparent; color:var(--fg); font-weight:700; cursor:pointer;
  }
  .btn.primary{ border-color:transparent; background:linear-gradient(180deg, var(--brand-2), var(--brand)); color:#fff; }
  .btn.danger{ border-color:transparent; background:linear-gradient(180deg, #f87171, var(--danger)); color:#fff; }
  .muted{ color:var(--muted); font-size:12px }

  .btn.btn-ghost{
    min-height: var(--tap);
    padding: 0 12px;
    border-radius: 10px;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--fg);
    font-weight: 700;
    cursor: pointer;
    opacity: .9;
  }
  .lesson-controls { margin-block: 8px 16px; }

  /* Accessibility */
  .sr-only{ position:absolute; left:-9999px; width:1px; height:1px; overflow:hidden; }
  @media (pointer:coarse){ .lesson, .btn, input[type="number"]{ min-height:52px } }
</style>

<script type="module" src="./js/session-page.js" defer></script>
</head>
<body>
  <div class="shell">
    <!-- Header -->
    <header class="hdr">
      <button id="menu-btn" class="hamburger" aria-expanded="false" aria-controls="lesson-drawer" aria-label="Open lessons">
        <span class="bars"><span class="bar"></span></span>
      </button>
      <div class="brand">Study Session</div>
      <div></div>
    </header>

    <!-- Lessons Drawer -->
    <nav id="lesson-drawer" class="drawer" aria-label="Lessons">
      <div class="lessons">
        <button class="lesson" data-base="./lessons/pl/lesson1/">
          Lesson 1 <span class="badge">Polish • A1</span>
        </button>
        <button class="lesson" disabled>Lesson 2 (locked)</button>
        <button class="lesson" disabled>Lesson 3 (locked)</button>

        <hr class="sep">
        <button class="menu-action" id="menu-comeback">Come back</button>
        <button class="menu-action" id="menu-signout">Sign out</button>
      </div>
    </nav>

    <!-- Reader -->
    <main class="reader" id="main">
      <article class="page" id="reader-page" aria-labelledby="reader-heading">
        <h3 id="reader-heading">Choose a lesson</h3>
        <div class="meta" id="reader-meta">No lesson loaded</div>
        <!-- NEW: dedicated mount the JS will replace -->
        <div id="reader-content">
          <p>Open the top menu and select <strong>Lesson 1</strong> to begin.</p>
        </div>
      </article>
    </main>
  </div>

  <!-- Floating Tomato (button) -->
  <button id="tomato" class="tomato" aria-haspopup="dialog" aria-controls="tomato-sheet" aria-expanded="false" aria-label="Open timer">
    <svg viewBox="0 0 64 64" role="img" aria-hidden="true">
      <path d="M32 10c5 0 8-4 10-6 2 3 2 7 0 10 8-2 14 3 16 8-4-1-8 0-11 2 9 4 15 13 15 22 0 12-10 18-30 18S2 58 2 46c0-9 6-18 15-22-3-2-7-3-11-2 2-5 8-10 16-8-2-3-2-7 0-10 2 2 5 6 10 6Z" fill="#ef4444"/>
      <path d="M26 12c3 2 7 2 12 0-2 3-5 5-8 5s-6-2-4-5Z" fill="#16a34a"/>
    </svg>
  </button>
  <!-- Invisible hotspot so the vanished tomato can be tapped on mobile -->
  <div id="tomato-hotspot" class="tomato-hotspot" aria-hidden="true"></div>

  <!-- Tomato Sheet (controls) -->
  <div id="tomato-sheet" class="sheet" role="dialog" aria-modal="false" aria-labelledby="timer-title" aria-hidden="true">
    <h2 id="timer-title" class="sr-only">Focus Timer</h2>
    <div class="row" style="margin-bottom:8px">
      <div id="time" class="time">25:00</div>
      <span class="muted" id="status" aria-live="polite"></span>
    </div>
    <div class="row" style="margin-bottom:8px">
      <label for="dur" class="sr-only">Duration (minutes)</label>
      <input id="dur" type="number" min="1" max="60" value="25" inputmode="numeric"/>
      <button id="start" class="btn primary">Start</button>
      <button id="pause" class="btn">Pause</button>
      <button id="reset" class="btn">Reset</button>
      <button id="finish" class="btn danger">Finish</button>
    </div>
    <div class="muted" id="total"></div>
  </div>
</body>
</html>
